<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Tag: Hacking - Meng Xipeng&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Meng Xipeng&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Meng Xipeng&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Meng Xipeng&#039;s blog"><meta property="og:url" content="http://mengxipeng1122.github.io/"><meta property="og:site_name" content="Meng Xipeng&#039;s blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://mengxipeng1122.github.io/img/og_image.png"><meta property="article:author" content="Meng Xipeng"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://mengxipeng1122.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://mengxipeng1122.github.io"},"headline":"Meng Xipeng's blog","image":["http://mengxipeng1122.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Meng Xipeng"},"publisher":{"@type":"Organization","name":"Meng Xipeng's blog","logo":{"@type":"ImageObject","url":"http://mengxipeng1122.github.io/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Meng Xipeng&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Hacking</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-01-07T08:42:04.000Z" title="1/7/2024, 4:42:04 PM">2024-01-07</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-07T09:55:08.552Z" title="1/7/2024, 5:55:08 PM">2024-01-07</time></span><span class="level-item">2 minutes read (About 316 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/01/07/How-to-indentify-NDK-version-of-a-so/">Identifying the NDK Version of a .so File</a></p><div class="content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>This blog post aims to provide a method for accurately identifying the version of the NDK (Native Development Kit) used in a .so file within the Android platform.</p>
<h1 id="Methodology"><a href="#Methodology" class="headerlink" title="Methodology"></a>Methodology</h1><p>In certain situations, it becomes necessary to confirm the specific NDK version utilized in the .so files of an APK. Once achieve this, we can compile our own binary code using the same NDK version and subsequently patch the resulting binary into the .so files in order to accomplish our objectives. It is crucial to note that using a different version of the NDK may lead to ABI (Application Binary Interface) incompatibility issues with our binary.</p>
<h1 id="Test-Case-“Rise-of-Saiyan”-Android-Game"><a href="#Test-Case-“Rise-of-Saiyan”-Android-Game" class="headerlink" title="Test Case: “Rise of Saiyan” Android Game"></a>Test Case: “Rise of Saiyan” Android Game</h1><p>For the purpose of illustration, we will employ the Android game called “Rise of Saiyan.” You may download the game from the following link: <a target="_blank" rel="noopener" href="https://en.riseofsaiyan.com/home.php">Rise of Saiyan</a>. Within this game, there exists a shared library file named libcocos2dlua.so.</p>
<h2 id="Locating-the-Magic-Word"><a href="#Locating-the-Magic-Word" class="headerlink" title="Locating the Magic Word"></a>Locating the Magic Word</h2><p>The initial step involves finding the magic word, which in this case is “Android”. We can accomplish this by executing the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ strings -tx libcocos2dlua.so | grep <span class="string">&quot;Android$&quot;</span></span><br><span class="line">13ab850 Android</span><br></pre></td></tr></table></figure>
<p>As demonstrated, we successfully discovered the magic word located at offset 0x13ab850.</p>
<h2 id="Extracting-the-NDK-Version-String"><a href="#Extracting-the-NDK-Version-String" class="headerlink" title="Extracting the NDK Version String"></a>Extracting the NDK Version String</h2><p>Next, we proceed to extract the NDK version string by hexdumping the content beginning from the identified offset:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexdump -C -n 30 -s $((<span class="number">0</span>x13ab850)) libcocos2dlua.so</span><br><span class="line">013ab850  41 6e 64 72 6f 69 64 00  15 00 00 00 72 32 31 65  |Android.....r21e|</span><br><span class="line">013ab860  00 00 00 00 00 00 00 00  00 00 00 00 00 00        |..............|</span><br><span class="line">013ab86e</span><br></pre></td></tr></table></figure>
<p>By analyzing the hexdump, we successfully identified the NDK version string as r21e. This information allows us to download the corresponding NDK version.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In conclusion, this blog post presents a straightforward method for identifying the NDK version string within a .so file. By following the outlined steps, developers can accurately determine the NDK version and proceed with their required tasks effectively and efficiently.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-31T07:24:00.000Z" title="8/31/2023, 3:24:00 PM">2023-08-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-07T08:39:54.134Z" title="1/7/2024, 4:39:54 PM">2024-01-07</time></span><span class="level-item">10 minutes read (About 1474 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/31/Hacking-Android-game-using-Frida-Part3/">Hacking Android Game using Frida - Part3</a></p><div class="content"><h1 id="Hacking-Android-Game-with-Frida-Part3"><a href="#Hacking-Android-Game-with-Frida-Part3" class="headerlink" title="Hacking Android Game with Frida (Part3)"></a>Hacking Android Game with Frida (Part3)</h1><p>In the previous blog <a href="http://mengxipeng1122.github.io/2023/08/29/Hacking-Android-game-using-Frida-Part2/">post</a>, we discussed how to create a NDK project to interact with an Android game. In this follow-up article, we will delve deeper into the game’s internals by call fucntions in <code>libmain.so</code>.</p>
<h2 id="Analyzing-libmain-so"><a href="#Analyzing-libmain-so" class="headerlink" title="Analyzing libmain.so"></a>Analyzing <code>libmain.so</code></h2><p>We have chosen a game for analysis because its libmain.so contains a multitude of interesting functions. To examine the symbols exported by the library, execute the following command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -sW libmain.so</span><br></pre></td></tr></table></figure>
<p>In our case, the library exports over 36,000 symbols. In theory, we can call each exported symbol using C++. This presents an exciting opportunity for exploration.</p>
<h2 id="Conducting-Static-and-Dynamic-Analysis-of-libmain-so"><a href="#Conducting-Static-and-Dynamic-Analysis-of-libmain-so" class="headerlink" title="Conducting Static and Dynamic Analysis of libmain.so"></a>Conducting Static and Dynamic Analysis of <code>libmain.so</code></h2><p>Before calling these functions from C++, it is essential to establish a goal. In our current scenario, our goal is relatively simple: we want to list all assets in the game, including their names and types. To accomplish this, we need to extract relevant class definitions from <code>libmain.so</code>. For static analysis, we will employ Ghidra, while Frida will assist us in adding hooks to key functions for inspecting the game’s internal state and memory data. Please note that this process is complex and time-consuming, but the results are well worth the effort. While we won’t delve into the entire analysis process in this blog, we will share the final results. The following are the classes we extracted for listing all assets in the game:</p>
<p>Note: These class definitions are highly dependent on the version of libmain.so used. The MD5 hash of the libmain.so file we worked with is <code>e721395e3e327899a5a55ea4fb422a1c</code>. Additionally, to ensure compatibility with a C compiler and facilitate analysis in Ghidra, I have utilized __cplusplus macros in the code. Ghidra supports C code, and by using these macros, we can import the code into Ghidra for easier analysis. This allows us to leverage Ghidra’s capabilities while working with the codebase.</p>
<h3 id="VuAsset"><a href="#VuAsset" class="headerlink" title="VuAsset"></a>VuAsset</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VuAsset</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VuAsset</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> * _vtab;               <span class="comment">// 0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    std::string _name;          <span class="comment">// 0x08</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _name[<span class="number">0x18</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The <code>VuAsset</code> class has a member variable, <code>_name</code>, of type std::string at offset 0x08, used to store the names of assets. In the ARM64 platform, a pointer occupies 8 bytes.</p>
<h3 id="VuAssetDB"><a href="#VuAssetDB" class="headerlink" title="VuAssetDB"></a>VuAssetDB</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VuAssetDB  size 0xe0</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VuAssetDB</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _0x0[<span class="number">0x40</span> ];   <span class="comment">// 0x00</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    std::map&lt;std::string, std::vector&lt;std::string&gt;&gt; _assetNames;  <span class="comment">// 0x40</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _assets[<span class="number">0x18</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The <code>VuAssetDB class</code> contains a member variable of type <code>std::map&lt;std::string, std::vector&lt;std::string&gt;&gt;</code> at offset 0x40, used to store the names of assets. The key of this variable is of type <code>std::string</code>, storing asset type names, while the value is of type <code>std::vector&lt;std::string&gt;</code>, storing asset names of the same type. We will utilize this class to print all asset names and types in the game.</p>
<h3 id="VuAssetFactory"><a href="#VuAssetFactory" class="headerlink" title="VuAssetFactory"></a>VuAssetFactory</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VuAssetFactory size 0x190</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VuAssetFactory</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _0x0[<span class="number">0x38</span> ]; <span class="comment">// 0x00</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    std::vector&lt;std::string&gt; _assetTypeNames; <span class="comment">// 0x38</span></span><br><span class="line">    std::map&lt;std::string, <span class="type">void</span>*&gt; _assetTypeInfos; <span class="comment">// 0x50</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _asssetTypeNames[<span class="number">0x18</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _asssetTypeInfos[<span class="number">0x18</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    VuAssetDB* _vuAssetDB; <span class="comment">// 0x68</span></span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _0x70[<span class="number">0x8</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    std::unordered_map&lt;<span class="type">unsigned</span> <span class="type">int</span>, VuAsset*&gt; _loadedAssets; <span class="comment">// 0x78</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> _asssetTypeNames[<span class="number">0x28</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    <span class="type">static</span> VuAssetFactory* mpInterface;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>
<p>The <code>VuAssetFactory</code> class includes a member variable of type <code>std::vector&lt;std::string&gt;</code> at offset 0x38, used to store asset type names. We can utilize this member variable to print all asset type names. Additionally, this class has a member variable of type <code>VuAssetDB*</code> at offset 0x68 to store the pointer to VuAssetDB. Furthermore, it contains a member variable of type <code>std::unordered_map&lt;unsigned int, VuAsset*&gt;</code> at offset 0x78, used to store loaded assets. The key of this variable is of type unsigned int, representing the asset hash calculated by asset name, and the valueis of type <code>VuAsset*</code>, storing the asset pointer. Lastly, the class includes a static member variable of type <code>VuAssetFactory*</code> to store the global instance of VuAssetFactory. This class follows the singleton design pattern, allowing us to obtain the global VuAssetFactory instance using mpInterface.</p>
<h2 id="Helper-Function-for-Obtaining-the-Actual-Class-Name-of-VuAsset-Children"><a href="#Helper-Function-for-Obtaining-the-Actual-Class-Name-of-VuAsset-Children" class="headerlink" title="Helper Function for Obtaining the Actual Class Name of VuAsset Children"></a>Helper Function for Obtaining the Actual Class Name of VuAsset Children</h2><p>Based on our analysis, we have observed that <code>VuAsset</code> acts as a base class for other asset-related classes. To simplify our tasks, we have implemented a helper function that allows us to retrieve the actual class names. Please find the code snippet below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">const</span> std::type_info&amp; <span class="title">getTypeInfoOfInstance_ndk</span><span class="params">(<span class="type">void</span>* p)</span>               </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    p = *(<span class="type">void</span>**)p;                                                           </span><br><span class="line">    p = ((<span class="type">void</span>**)p)[<span class="number">-1</span>];                                                                                                                                     </span><br><span class="line">    <span class="keyword">return</span> *(std::type_info*)p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Given that <code>libgame.so</code> is compiled with the RTTI (Run-Time Type Information) option, we can utilize the <code>getTypeInfoOfInstance_ndk</code> function to obtain the class information of instances. It’s important to note that we cannot directly use the typeid operator to retrieve runtime type information (RTTI) of an object. This is because <code>libgame.so</code> contains the RTTI information, and when we write our C++ code in <code>libmousebot.so</code>, the typeid operator will provide the RTTI information from <code>libmousebot.so</code>, which may lead to incorrect results. Since we don’t have visibility into how the derived classes of <code>VuAsset</code> are defined, the <code>getTypeInfoOfInstance_ndk</code> function helps us retrieve the accurate class information from <code>libgame.so</code>.</p>
<h2 id="Print-all-assets-names-and-types"><a href="#Print-all-assets-names-and-types" class="headerlink" title="Print all assets names and types"></a>Print all assets names and types</h2><p>Now, it’s time to rock! In this section, we will demonstrate how to print all asset names and types using functions provided by libgame.so. This will serve as a great starting point for exploring Frida’s capabilities and the powerful combination of Frida and C++.</p>
<ol>
<li><p>Get global pointer to the instance of <code>VuAssetFactory</code><br>To begin, we need to obtain the global pointer to the instance of <code>VuAssetFactory</code>. This can be achieved with the following code snippet:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>* pVuAssetFactory = VuAssetFactory::mpInterface; </span><br></pre></td></tr></table></figure></li>
<li><p>Get the instance of <code>VuAssetDB</code><br>Next, we retrieve the instance of <code>VuAssetDB</code> using the pointer obtained in the previous step. The code is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>* pVuAssetDB = pVuAssetFactory-&gt;_vuAssetDB;</span><br></pre></td></tr></table></figure></li>
<li><p>List all assets in <code>VuAssetDB</code><br>In this step, we iterate through all the assets in <code>VuAssetDB</code> and print their names and types. The code snippet below demonstrates this process:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">for</span>( <span class="keyword">auto</span> it = pVuAssetDB-&gt;_assetNames.<span class="built_in">begin</span>(); it != pVuAssetDB-&gt;_assetNames.<span class="built_in">end</span>(); ++it)&#123;                                                              </span><br><span class="line">    <span class="keyword">auto</span>&amp; assetType = it-&gt;first;</span><br><span class="line">    <span class="keyword">auto</span>&amp; names = it-&gt;second;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it1=names.<span class="built_in">begin</span>(); it1!=names.<span class="built_in">end</span>(); ++it1)&#123;</span><br><span class="line">        <span class="built_in">LOG_INFOS</span>(<span class="string">&quot; %s : %s&quot;</span>, assetType.<span class="built_in">c_str</span>(), it1-&gt;<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, the <code>LOG_INFOS</code> macro is used to print the asset information, which internally calls the <code>_frida_log</code> function.<br>The resulting output will be similar to the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;...&gt;</span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:104]  VuTextureAsset : UI/Icons/Inventory_Prize                                                       </span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:104]  VuTextureAsset : UI/Icons/Inventory_Skin                                                        </span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:104]  VuTextureAsset : UI/Icons/KeyCard_A    </span><br><span class="line">&lt;...&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>List All Loaded Assets in the Game<br>In this final step, we will list all the loaded assets in the game. Although <code>VuAssetDB</code> contains all the assets, it only provides basic information for each asset. During the game runtime, the actual asset data is loaded on demand.<br>The code snippet below demonstrates how to iterate through the loaded assets and print their information:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>&amp; v = pVuAssetFactory-&gt;_loadedAssets;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); ++it)&#123;</span><br><span class="line">    <span class="keyword">auto</span>* pAsset = it-&gt;second;</span><br><span class="line">    <span class="keyword">auto</span>&amp; k = it-&gt;first;</span><br><span class="line">    <span class="keyword">auto</span>&amp; assetTypeInfo = <span class="built_in">getTypeInfoOfInstance_ndk</span>(pAsset);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* assetTypeName = assetTypeInfo.<span class="built_in">name</span>();</span><br><span class="line">    <span class="built_in">LOG_INFOS</span>(<span class="string">&quot; %x pAsset %p assetTypeName %s assetName %s&quot;</span>, k, pAsset, assetTypeName, pAsset-&gt;_name.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this code, we use the <code>getTypeInfoOfInstance_ndk</code> function to retrieve the actual class name of each asset instance. The resulting output will be similar to the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;...&gt;</span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:118]  e1fc0284 pAsset 0x77e86e1e40 assetTypeName 18VuStaticModelAsset assetName Env/Hall/Straight_16m</span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:118]  93b383af pAsset 0x77c03b1f00 assetTypeName 15VuMaterialAsset assetName Paper/Cardboard_Wall</span><br><span class="line">[/mnt/work/work.2023/frida-hackinggame/jni/mousebot.cc:118]  9f8e3cbb pAsset 0x77b8be9810 assetTypeName 15VuTemplateAsset assetName Tile_Hall_Hazard/Hall_Hazard_Stomper_2x_16m</span><br><span class="line">&lt;...&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>You can find the complete source code in the <a target="_blank" rel="noopener" href="https://github.com/mengxipeng1122/frida-hackinggame">repository</a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Congratulations! This marks the end of our exploration series. In this final log, we have successfully printed all asset information in the game using the functions provided by <code>libgame.so</code>. This serves as a solid foundation for further exploration of Frida’s capabilities. The combination of Frida and C++ opens up a world of possibilities, allowing us toperform various interesting tasks. With the knowledge gained from this series, you can continue your journey of hacking and exploring the game.</p>
<p>Remember, Frida and C++ together are a powerful toolset that can enable us to accomplish a wide range of tasks. The ability to access and manipulate game assets opens up exciting possibilities for customization, analysis, and experimentation.</p>
<p>Happy hacking, and enjoy your adventures in the world of game exploration!</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-29T06:53:23.000Z" title="8/29/2023, 2:53:23 PM">2023-08-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-05T06:19:13.301Z" title="10/5/2023, 2:19:13 PM">2023-10-05</time></span><span class="level-item">9 minutes read (About 1350 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/29/Hacking-Android-game-using-Frida-Part2/">Hacking Android game using Frida - Part2</a></p><div class="content"><h1 id="Hacking-Android-Games-with-Frida-Part2"><a href="#Hacking-Android-Games-with-Frida-Part2" class="headerlink" title="Hacking Android Games with Frida (Part2)"></a>Hacking Android Games with Frida (Part2)</h1><p>In the previous blog <a href="http://mengxipeng1122.github.io/2023/08/29/Hacking-Android-game-using-Frida-Part1/">post</a>, we discussed how to create a Frida Typescript project to interact with an Android game. In this follow-up article, we will delve deeper into the game’s internals by using the NDK (Native Development Kit) and explore the process of hacking Android games using Frida.</p>
<h2 id="NDK-Version-enumeration"><a href="#NDK-Version-enumeration" class="headerlink" title="NDK Version enumeration"></a>NDK Version enumeration</h2><p>To begin, we need to identify the NDK version used to compile the game’s native library (libmain.so). Follow these steps:<br>    1. Navigate to the game data directory on the Android device. The path may vary, but an example path is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /data/app/com.vectorunit.mercury.googleplay-hN_B8AKQmUeVXiBbDZ2Vvg==/lib/arm64</span><br></pre></td></tr></table></figure>
<p>Note: Replace com.vectorunit.mercury.googleplay-hN_B8AKQmUeVXiBbDZ2Vvg&#x3D;&#x3D; with the actual game ID on your device.<br>    2. In the game data directory, we can find a file <code>libmain.so</code>. Copy it to PC.<br>    3. Extract strings from libmain.so using the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings -tx libmain.so</span><br></pre></td></tr></table></figure>
<p>Look for the version strings and commit IDs in the command output. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ad4dac Android (7714059, based on r416183c1) clang version 12.0.8 (https://android.googlesource.com/toolchain/llvm-project c935d99d7cf2016289302412d708641d52d2f7ee)</span><br><span class="line">ad4e4a Android (4691093 based on r316199) clang version 6.0.2 (https://android.googlesource.com/toolchain/clang 183abd29fc496f55536e7d904e0abae47888fc7f) (https://android.googlesource.com/toolchain/llvm 34361f192e41ed6e4e8f9aca80a4ea7e9856f327) (based on LLVM 6.0.2svn)</span><br><span class="line">ad4f52 Linker: LLD 12.0.8 (/buildbot/src/android/llvm-r416183/out/llvm-project/lld c935d99d7cf2016289302412d708641d52d2f7ee)</span><br></pre></td></tr></table></figure>
<p>Perform a Google search using the version strings and commit IDs to determine the NDK version. In this example, I assume the game was compiled with NDK r17c.<br>    4. Download the according NDK from <a target="_blank" rel="noopener" href="https://developer.android.com/ndk/downloads/index.html">here</a>, and uncompress it to your PC. </p>
<p>NOTE: NDK r17c is an older version and may not work with newer versions of Linux. Refer this <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/48674104/clang-error-while-loading-shared-libraries-libtinfo-so-5-cannot-open-shared-o">page</a> for potential issues of to run clang++ on NDK r17c.  The provided solution in that post can help resolve the issue.</p>
<h1 id="Create-helper-function-in-Typescript-for-C-code"><a href="#Create-helper-function-in-Typescript-for-C-code" class="headerlink" title="Create helper function in Typescript for C++ code"></a>Create helper function in Typescript for C++ code</h1><p>Next, we will create two helper functions in Typescript that can be called from C++ code:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _frida_log = <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span>(<span class="params">sp:NativePointer</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(sp.<span class="title function_">readUtf8String</span>());                                         </span><br><span class="line">&#125;, <span class="string">&#x27;void&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">                                       </span><br><span class="line"><span class="keyword">const</span> _frida_hexdump = <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span>(<span class="params">sp:NativePointer, sz:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(                                                              </span><br><span class="line">        <span class="title function_">hexdump</span>(sp, &#123;</span><br><span class="line">            <span class="attr">offset</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">length</span>: sz,</span><br><span class="line">            <span class="attr">header</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">ansi</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;, <span class="string">&#x27;void&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;uint&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<ul>
<li>_frida_log: This function outputs a string and accepts a pointer to the string.</li>
<li>_frida_hexdump:This function performs a hexdump of a block of memory and accepts a pointer to the memory and its length.</li>
</ul>
<h1 id="Build-the-NDK-so-file"><a href="#Build-the-NDK-so-file" class="headerlink" title="Build the NDK .so file"></a>Build the NDK .so file</h1><p>To build the NDK shared library (.so file), follow these steps:</p>
<ol>
<li>Create a subdirectory named <code>jni</code>.</li>
<li>Navigate to the <code>jni</code> directory.</li>
<li>Create a C++ file named <code>mousebot.cc</code> with the following content:<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="type">void</span> _frida_log(<span class="type">const</span> <span class="type">char</span>* p);</span><br><span class="line">    <span class="type">void</span> _frida_hexdump(<span class="type">void</span>* p, <span class="type">unsigned</span> <span class="type">int</span> i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">int</span> <span class="title">test</span><span class="params">(<span class="type">void</span>* base)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    _frida_log(<span class="string">&quot;Hello from C++ !&quot;</span>);</span><br><span class="line">    _frida_hexdump(base, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>The declarations for the helper functions are enclosed in extern “C” to avoid C++ name mangling.</li>
<li>The test function accepts a pointer to memory, calls the helper functions, and returns 0.</li>
</ul>
<ol start="4">
<li>Create <code>Android.mk</code> file with the following content:<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(CLEAR_VARS)</span></span><br><span class="line">LOCAL_MODULE:= mousebot</span><br><span class="line">LOCAL_SRC_FILES := mousebot.cc</span><br><span class="line">LOCAL_C_INCLUDES := </span><br><span class="line">LOCAL_LDLIBS :=</span><br><span class="line">LOCAL_CFLAGS= </span><br><span class="line">LOCAL_ALLOW_UNDEFINED_SYMBOLS := true</span><br><span class="line">LOCAL_SHARED_LIBRARIES =</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(BUILD_SHARED_LIBRARY)</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>This file instructs NDK to build a shared library. I set LOCAL_ALLOW_UNDEFINED_SYMBOLS to true to avoid compiler to complain about undefined symbols for our defined helper functions. We implements the helper functions in Typescript. We have no library for compiler to link.</li>
</ul>
<ol start="5">
<li>Create <code>Application.mk</code> file with the following content:<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">APP_PLATFORM=android-27</span><br><span class="line">APP_ABI=arm64-v8a</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>To determine the Android API level of your device, use the following command:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop  | grep api_level</span><br></pre></td></tr></table></figure></li>
<li>To determine the CPU ABI, use the following command:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell getporop ro.product.cpu.abi</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="6">
<li>Create <code>Makefile</code> file with the following content:<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifndef</span> NDKPATH</span><br><span class="line">    <span class="variable">$(<span class="built_in">error</span> NDKPATH not set)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: build_android</span></span><br><span class="line"></span><br><span class="line"><span class="section">build_android:</span></span><br><span class="line">        $&#123;NDKPATH&#125;/ndk-build V=1</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">        $&#123;NDKPATH&#125;/ndk-build clean</span><br></pre></td></tr></table></figure>
This Makefile instructs the NDK to build the shared library, while enabling verbose mode with the V&#x3D;1 flag. Make sure to export the NDKPATH environment variable with the path to your actual NDK installation. By running <code>make</code>, the shared library will be built, and you can find it in the <code>libs/arm64-v8a/libmousebot.so</code> directory.</li>
</ol>
<h1 id="Convert-so-file-to-typescript-module"><a href="#Convert-so-file-to-typescript-module" class="headerlink" title="Convert .so file to typescript module"></a>Convert .so file to typescript module</h1><p>Next, we’ll convert the generated .so file into a TypeScript module. To accomplish this, we have provided a Python script called so2ts.py, which you can find <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/mengxipeng1122/frida-hackinggame/master/utils/so2ts.py">here</a>. The script performs the following steps:</p>
<ol>
<li>Parse the .so file using LIEF library</li>
<li>Generate a .ts file that loads the .so file manually:</li>
</ol>
<ul>
<li>Allocates memory for the .so file, and loads it into the allocated memory, set ting the permissions to <code>rwx</code>.</li>
<li>Applies hot patches to the .so file using the information from the relocation sectin.</li>
<li>Invokes constoructors of the .so file.</li>
</ul>
<p>To run the script, execute the following command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./utils/so2ts.py -b libs/arm64-v8a/libmousebot.so -o modinfos/libmousebot.ts</span><br></pre></td></tr></table></figure>
<p>The generated TypeScript file will be located at <code>modinfos/libmousebot.ts</code>.</p>
<h1 id="Call-the-Test-function-in-Typescript"><a href="#Call-the-Test-function-in-Typescript" class="headerlink" title="Call the Test function in Typescript"></a>Call the Test function in Typescript</h1><p>Now that we have the converted TypeScript module, we can proceed to call the C++ function from TypeScript. Here’s how you can accomplish this:</p>
<h2 id="import-the-generated-ts-file"><a href="#import-the-generated-ts-file" class="headerlink" title="import the generated  .ts file"></a>import the generated  .ts file</h2><p>In your TypeScript code <code>index.ts</code>, import the generated .ts file as follows:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mod <span class="keyword">as</span> libmousebotinfo&#125; <span class="keyword">from</span> <span class="string">&#x27;./modinfos/libmousebot&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Load-the-so-file"><a href="#Load-the-so-file" class="headerlink" title="Load the .so file"></a>Load the .so file</h2><p>Add the following code to index.ts to load the .so file:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> soname =<span class="string">&#x27;libmain.so&#x27;</span></span><br><span class="line"><span class="keyword">const</span> lib = libmousebotinfo.<span class="title function_">load</span>([</span><br><span class="line">    soname,</span><br><span class="line">],&#123;</span><br><span class="line">    _frida_log      , </span><br><span class="line">    _frida_hexdump  ,</span><br><span class="line">     </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>In the code snippet above, <code>soname</code> represents the name of the original <code>libmain.so</code> file. Since the game process loads this .so file during boot, we pass <code>soname</code> to libmousebotinfo.load to enable our .so file to resolve symbols from this library. Additionally, we pass <code>_frida_log</code> and <code>_frida_hexdump</code> to <code>libmousebotinfo.load</code> to provide these two functions to our .so file.</p>
<h2 id="Call-test-function"><a href="#Call-test-function" class="headerlink" title="Call test function"></a>Call test function</h2><p>To call the test function in libmousebot.so, use the following TypeScript code:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> m = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(soname);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">NativeFunction</span>(lib.<span class="property">symbols</span>.<span class="property">test</span>, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>])(m.<span class="property">base</span>);</span><br></pre></td></tr></table></figure>
<p>In the code snippet above, we obtain the base address of <code>libmain.so</code> using <code>Process.getModuleByName</code>. Then, we invoke the test function in <code>libmousebot.so</code>  using <code>lib.symbols.test</code>, where <code>lib.symbols</code> includes all the symbols exported by <code>libmousebot.so</code>.</p>
<h2 id="Recompile-index-ts-and-inject-the-Frida-script"><a href="#Recompile-index-ts-and-inject-the-Frida-script" class="headerlink" title="Recompile index.ts and inject the Frida script"></a>Recompile <code>index.ts</code> and inject the Frida script</h2><p>With all the necessary code prepared, we can recompile index.ts and inject the Frida script into the game process. Use the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l _agent.js -n &#x27;MouseBot&#x27;</span><br></pre></td></tr></table></figure>
<p>When executed, the console will display the following output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##################################################</span><br><span class="line">Hello from C++ !</span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">7a26ace000  7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00  .ELF............</span><br><span class="line">7a26ace010  03 00 b7 00 01 00 00 00 d4 04 72 00 00 00 00 00  ..........r.....</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In this tutorial, we have learned how to build a shared library using the Android NDK and call C++ functions from TypeScript. By leveraging Frida, we successfully integrated the functionalities of <code>libmousebot.so</code> with the existing <code>libmain.so</code> of the game process. This opens up possibilities for further exploration and utilization of Frida’s capabilities.</p>
<p>In the next blog post, we will delve deeper into Frida’s extensive feature set and explore how to call functions in <code>libmain.so</code> from our custom <code>libmousebot.so</code>.</p>
<p>Thank you for following along! If you have any further questions or need assistance, feel free to reach out.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-29T03:26:43.000Z" title="8/29/2023, 11:26:43 AM">2023-08-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-05T06:19:13.301Z" title="10/5/2023, 2:19:13 PM">2023-10-05</time></span><span class="level-item">4 minutes read (About 659 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/29/Hacking-Android-game-using-Frida-Part1/">Hacking Android game using Frida - Part1</a></p><div class="content"><h1 id="Hacking-Android-Games-with-Frida-Part1"><a href="#Hacking-Android-Games-with-Frida-Part1" class="headerlink" title="Hacking Android Games with Frida (Part1)"></a>Hacking Android Games with Frida (Part1)</h1><h2 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer:"></a>Disclaimer:</h2><p>The techniques and information presented in this serial of blogs are strictly for educational purposes. Unauthorized use of these techniques for illicit activities, including game hacking, is strictly prohibited. The author and publisher do not condone or support any form of illegal or unethical behavior. It is essential to respect the intellectual property rights of game developers and adhere to the terms of service. Any actions taken based on the knowledge gained from this blog are solely at the reader’s own risk, and the author and publisher are not liable for any misuse or legal consequences that may arise.</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction:"></a>Introduction:</h2><p>Mobile gaming has become a massive industry, and many players strive to gain an edge by tweaking or modifying Android games. One powerful tool for game hacking is <a target="_blank" rel="noopener" href="https://frida.re/">Frida</a>, an open-source dynamic instrumentation framework. In this serial of blogs, we will guide you through the process of creating a Frida project using TypeScript, enabling you to hack Android games and unlock new possibilities.<br>I will put all source codes in <a target="_blank" rel="noopener" href="https://github.com/mengxipeng1122/frida-hackinggame">here</a>.</p>
<h2 id="The-Game-for-Testing"><a href="#The-Game-for-Testing" class="headerlink" title="The Game for Testing:"></a>The Game for Testing:</h2><p>For the purpose of testing and learning, we will use “MouseBot”, a popular and addictive runner game developed by Vector Unit. You can download the Android version of the game for free from the Play Store <a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=com.vectorunit.mercury.googleplay&hl=en&gl=US">here</a>. It’s free.</p>
<h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites:"></a>Prerequisites:</h1><p>To follow along with this tutorial, you’ll need the following:</p>
<ul>
<li>A basic understanding of TypeScript.</li>
<li>Node.js installed on your machine.</li>
<li>A rooed Android device or emulator.</li>
<li>Frida installed on your machine.</li>
<li>Test game , MouseBot, installed in your machine.</li>
</ul>
<h1 id="Step-1-Setting-Up-the-Project"><a href="#Step-1-Setting-Up-the-Project" class="headerlink" title="Step 1: Setting Up the Project"></a>Step 1: Setting Up the Project</h1><ul>
<li>Create a new directory for your Frida project.</li>
<li>Open a terminal or command prompt and navigate to the project directory.</li>
<li>Create a file named <code>package.json</code> in the project directory. You can view its content from <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/mengxipeng1122/frida-hackinggame/master/package.json">here</a>.</li>
<li>Create a file named <code>tsconfig.json</code> in the project directory. You can view its content from <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/mengxipeng1122/frida-hackinggame/master/tsconfig.json">here</a>.</li>
<li>Install the Frida library for TypeScript and frida-compile by executing the following command, I have write these libraries in this <code>package.json</code>:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i </span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Step-2-Writing-the-Frida-Script"><a href="#Step-2-Writing-the-Frida-Script" class="headerlink" title="Step 2: Writing the Frida Script"></a>Step 2: Writing the Frida Script</h1><ul>
<li>Inside your project directory, create a new TypeScript file, index.ts:</li>
<li>Open the file in your preferred code editor.<br>Write the Frida script to print <code>Hello world</code> to the console.<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">test</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;##################################################&#x27;</span>)</span><br><span class="line"><span class="title function_">test</span>()</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Step-3-Running-the-Frida-Script"><a href="#Step-3-Running-the-Frida-Script" class="headerlink" title="Step 3: Running the Frida Script"></a>Step 3: Running the Frida Script</h1><ul>
<li>Save the game-hack.ts file.</li>
<li>Open a terminal or command prompt and navigate to the project directory.</li>
<li>Create a file named <code>Makefile</code> in the project directory. Its content is shown as follows:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all:</span><br><span class="line">        ./node_modules/frida-compile/bin/compile.js -o _agent.js index.ts</span><br></pre></td></tr></table></figure></li>
<li>Compile the TypeScript file into JavaScript using the following command:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
This command will create a file named _agent.js in the project directory.</li>
<li>Run the Frida script using the following command:</li>
<li>Setup your Android device, start frida-server. <a target="_blank" rel="noopener" href="https://frida.re/docs/android/">This page</a> has detailed instructions for this step.</li>
<li>Launch <code>MouseBot</code> on your Android device or emulator.</li>
<li>Execute the following command to inject the Frida script into the game process:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l _agent.js -n &#x27;MouseBot&#x27;</span><br></pre></td></tr></table></figure>
If everything goes well, Frida will inject the script into the game process. and you will see <code>Hello world</code> in the console.</li>
</ul>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion:"></a>Conclusion:</h1><p>In this blog, we explored the initial steps of creating a Frida project using TypeScript and injecting a basic Frida script into an Android game. We emphasized the importance of using this knowledge responsibly and for educational purposes only. In the next blog of this series, we will delve deeper into Frida’s capabilities and explore more advanced game hacking techniques. Stay tuned and happy hacking!</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Meng Xipeng"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Meng Xipeng</p><p class="is-size-6 is-block">Reverse engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">18</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/mengxipeng1122" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/meng_xi_peng"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-22T07:22:24.000Z">2024-01-22</time></p><p class="title"><a href="/2024/01/22/Mastering-Frida-A-Guide-to-Fixing-Early-Instrumentation-in-Gadget-Mode/">Mastering Frida: A Guide to Fixing Early Instrumentation in Gadget Mode</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-07T08:42:04.000Z">2024-01-07</time></p><p class="title"><a href="/2024/01/07/How-to-indentify-NDK-version-of-a-so/">Identifying the NDK Version of a .so File</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-28T00:41:13.000Z">2023-10-28</time></p><p class="title"><a href="/2023/10/28/Hacking-Cocos2D-Android-Games-using-Frida/">Hacking Cocos2D Android Games using Frida</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-31T07:24:00.000Z">2023-08-31</time></p><p class="title"><a href="/2023/08/31/Hacking-Android-game-using-Frida-Part3/">Hacking Android Game using Frida - Part3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-29T06:53:23.000Z">2023-08-29</time></p><p class="title"><a href="/2023/08/29/Hacking-Android-game-using-Frida-Part2/">Hacking Android game using Frida - Part2</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CModule/"><span class="tag">CModule</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cocos2d/"><span class="tag">Cocos2d</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Frida/"><span class="tag">Frida</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Game/"><span class="tag">Game</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hack/"><span class="tag">Hack</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hacking/"><span class="tag">Hacking</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Inline-hook/"><span class="tag">Inline hook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NDK/"><span class="tag">NDK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse-engineering/"><span class="tag">Reverse engineering</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Thumb/"><span class="tag">Thumb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hack/"><span class="tag">hack</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hacking/"><span class="tag">hacking</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inlinehook/"><span class="tag">inlinehook</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Meng Xipeng&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Meng Xipeng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>