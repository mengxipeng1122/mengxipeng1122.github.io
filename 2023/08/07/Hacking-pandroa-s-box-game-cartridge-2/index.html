<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hacking Pandora&#039;s Box Game Cartridge 2 - Meng Xipeng&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Meng Xipeng&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Meng Xipeng&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="DisclaimerThis blog is intended solely for educational purposes. Please refrain from using this information for malicious purposes. IntroductionI recently acquired a new Pandora’s Box game cartridge,"><meta property="og:type" content="blog"><meta property="og:title" content="Hacking Pandora&#039;s Box Game Cartridge 2"><meta property="og:url" content="http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/"><meta property="og:site_name" content="Meng Xipeng&#039;s blog"><meta property="og:description" content="DisclaimerThis blog is intended solely for educational purposes. Please refrain from using this information for malicious purposes. IntroductionI recently acquired a new Pandora’s Box game cartridge,"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://mengxipeng1122.github.io/images/PB2_PCB.jpg"><meta property="article:published_time" content="2023-08-07T06:12:53.000Z"><meta property="article:modified_time" content="2023-10-05T06:19:13.301Z"><meta property="article:author" content="Meng Xipeng"><meta property="article:tag" content="Game"><meta property="article:tag" content="Hack"><meta property="article:tag" content="Reverse engineering"><meta property="article:tag" content="ARM"><meta property="article:tag" content="Python"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://mengxipeng1122.github.io/images/PB2_PCB.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/"},"headline":"Hacking Pandora's Box Game Cartridge 2","image":["http://mengxipeng1122.github.io/images/PB2_PCB.jpg"],"datePublished":"2023-08-07T06:12:53.000Z","dateModified":"2023-10-05T06:19:13.301Z","author":{"@type":"Person","name":"Meng Xipeng"},"publisher":{"@type":"Organization","name":"Meng Xipeng's blog","logo":{"@type":"ImageObject","url":"http://mengxipeng1122.github.io/img/logo.svg"}},"description":"DisclaimerThis blog is intended solely for educational purposes. Please refrain from using this information for malicious purposes. IntroductionI recently acquired a new Pandora’s Box game cartridge,"}</script><link rel="canonical" href="http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Meng Xipeng&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-07T06:12:53.000Z" title="8/7/2023, 2:12:53 PM">2023-08-07</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-05T06:19:13.301Z" title="10/5/2023, 2:19:13 PM">2023-10-05</time></span><span class="level-item">7 minutes read (About 1113 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Hacking Pandora&#039;s Box Game Cartridge 2</h1><div class="content"><h1 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h1><p>This blog is intended solely for educational purposes. Please refrain from using this information for malicious purposes.</p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>I recently acquired a new Pandora’s Box game cartridge, which utilizes the RK3128 system-on-a-chip (SOC) from Rockchip. I wanted to share my experience with hacking it.<br>The manufacturer has overclocked it to 1.5GHz to ensure smooth gameplay with HD video filtering. However, due to the increased performance, an additional fan is required for cooling. Fortunately, the cartridge uses an SD card for booting, making it easy to dump the firmware.Here is a photo of the PCB:<br><img src="/images/PB2_PCB.jpg" alt="PCB"></p>
<h1 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h1><p>The system initiates the “loader” program to extract necessary files and launch the main program, “mkemu.” The manufacturer has placed the “loader” in the initram filesystem of the kernel, which is in CPIO format. Extracting the “loader” binary is a straightforward process.<br>The following code snippet from &#x2F;etc&#x2F;init.d&#x2F;rcS in the initram reveals how the system starts the “loader” program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">PATH=/bin:/sbin:/usr/bin:/usr/sbin</span><br><span class="line">runlevel=S</span><br><span class="line">prevlevel=N</span><br><span class="line"><span class="built_in">umask</span> 022</span><br><span class="line"><span class="built_in">export</span> PATH runlevel prevlevel</span><br><span class="line"></span><br><span class="line">mount -t tmpfs mdev /dev</span><br><span class="line"><span class="built_in">mkdir</span> /dev/pts</span><br><span class="line"><span class="built_in">mkdir</span> /dev/shm</span><br><span class="line"></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug</span><br><span class="line">mdev -s</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /dev/mdev.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="built_in">mkdir</span> -m 1777 .X11-unix</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /lib/modules/3.4.39-h3</span><br><span class="line">insmod elib.ko</span><br><span class="line"><span class="comment">#insmod ch341.ko</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        /home/games/loader</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="Analyzing-the-Loader-Program"><a href="#Analyzing-the-Loader-Program" class="headerlink" title="Analyzing the Loader Program"></a>Analyzing the Loader Program</h2><p>I loaded the “loader” program into Ghidra and performed an automated analysis. At address 0x11b10, it becomes evident that the “loader” attempts to mount a LUKS filesystem file:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sprintf</span>(uStack_620,<span class="string">&quot;echo -n \&quot;%s\&quot; | cryptsetup luksOpen /dev/dm-1 pass -&quot;</span>,&amp;DAT_00028c94);</span><br><span class="line">system(uStack_620);</span><br></pre></td></tr></table></figure>
<p>The LUKS key is stored in ASCII format at address DAT_00028c94 and is calculated using a number read from &#x2F;dev&#x2F;elib. The function at 0x14720 includes the code to read the original number from &#x2F;dev&#x2F;elib:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">read_rand_seed</span><span class="params">(<span class="type">void</span> *data)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> __fd;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  </span><br><span class="line">  __fd = open(<span class="string">&quot;/dev/elib&quot;</span>,<span class="number">0</span>);</span><br><span class="line">  elib_fd = __fd;</span><br><span class="line">  <span class="keyword">if</span> (__fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    iVar1 = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    iVar1 = ioctl(__fd,<span class="number">0x80045a13</span>,data);</span><br><span class="line">    iVar1 = iVar1 &gt;&gt; <span class="number">0x1f</span>;</span><br><span class="line">    close(__fd);</span><br><span class="line">    elib_fd = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> iVar1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Fortunately, the programmer compiled the Linux driver into an individual .ko file instead of including it in the kernel binary. This allows us to easily locate the code responsible for returning the number within the small .ko file.</p>
<h2 id="Analyzing-elib-ko"><a href="#Analyzing-elib-ko" class="headerlink" title="Analyzing elib.ko"></a>Analyzing <code>elib.ko</code></h2><p>We can find elib.ko in the CPIO filesystem. By loading it into Ghidra, we can locate the code that handles the 0x80045a13 ioctl code in the elib_ioctl function. Ghidra’s decompiled C code provides the following information:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (param_2 == <span class="number">0x80045a13</span>) &#123;</span><br><span class="line">  local_2c = (undefined *)<span class="number">0x0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;local_28,<span class="number">0</span>,<span class="number">0x10</span>);</span><br><span class="line">  pcVar2 = <span class="built_in">strstr</span>(saved_command_line,<span class="string">&quot;custom_id=&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (pcVar2 != (<span class="type">char</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">    pcVar2 = pcVar2 + <span class="number">10</span>;</span><br><span class="line">    pcVar3 = <span class="built_in">strchr</span>(pcVar2,<span class="number">0x20</span>);</span><br><span class="line">    <span class="keyword">if</span> (pcVar3 == (<span class="type">char</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">      __n = <span class="built_in">strlen</span>(pcVar2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      __n = (<span class="type">int</span>)pcVar3 - (<span class="type">int</span>)pcVar2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (__n &lt; <span class="number">0x10</span>) &#123;</span><br><span class="line">      <span class="built_in">strncpy</span>((<span class="type">char</span> *)&amp;local_28,pcVar2,__n);</span><br><span class="line">      local_2c = (undefined *)simple_strtoul(&amp;local_28,<span class="number">0</span>,<span class="number">0x10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (local_2c == (undefined *)<span class="number">0x0</span>) &#123;</span><br><span class="line">    local_2c = (undefined *)<span class="number">0x87654321</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  printk(<span class="string">&quot;\x011custom id: %x\n&quot;</span>,(uint)local_2c);</span><br><span class="line">  puVar6 = *(undefined **)(((uint)local_38 &amp; <span class="number">0xffffe000</span>) + <span class="number">8</span>);</span><br><span class="line">  bVar12 = (undefined *)<span class="number">0xfffffffb</span> &lt; param_3;</span><br><span class="line">  <span class="keyword">if</span> (!bVar12) &#123;</span><br><span class="line">    bVar12 = puVar6 &lt; param_3 + <span class="number">4</span> || (uint)((<span class="type">int</span>)(param_3 + <span class="number">4</span>) - (<span class="type">int</span>)puVar6) &lt; (uint)bVar12;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!bVar12) &#123;</span><br><span class="line">    puVar6 = (undefined *)<span class="number">0x0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (puVar6 != (undefined *)<span class="number">0x0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ppuVar4 = &amp;local_2c;</span><br><span class="line">  uVar5 = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">goto</span> LAB_00010668;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (param_2 != <span class="number">0x80045a0b</span>) <span class="keyword">goto</span> LAB_00010674;</span><br></pre></td></tr></table></figure>
<p>And the programmer is lazy, as he hardcoded this sensitive number. It’s 0x87654321. I noticed there is an MCU on the PCB, and I suspected the programmer might have stored the number in the MCU, but he didn’t.</p>
<h2 id="Find-the-key-for-the-LUKS-file"><a href="#Find-the-key-for-the-LUKS-file" class="headerlink" title="Find the key for the LUKS file"></a>Find the key for the LUKS file</h2><p>Now, it’s time to calculate the key for the LUKS file. I decided to use <a target="_blank" rel="noopener" href="https://www.unicorn-engine.org/">unicorn engine</a> for this task, I wrote a python <a target="_blank" rel="noopener" href="https://gist.github.com/mengxipeng1122/dc6b97944f370bf0f87a377946971229">script</a> for this task.<br>This script requires the preparation of the file rocky.rsa and the number 0x87654321. The thumb instructions call the standard libc functions, memset and memcpy. I simulate these two functions in the block_hook section. The following is the code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(address==<span class="number">0x10cb4</span>):  </span><br><span class="line">    <span class="comment"># void * memset(void *__s,int __c,size_t __n)</span></span><br><span class="line">    s = uc.reg_read(UC_ARM_REG_R0)</span><br><span class="line">    c = uc.reg_read(UC_ARM_REG_R1)</span><br><span class="line">    n = uc.reg_read(UC_ARM_REG_R2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hook memset&#x27;</span>, <span class="built_in">hex</span>(s), c, n)</span><br><span class="line">    uc.mem_write(s, <span class="built_in">bytes</span>([c]*n))</span><br><span class="line">    uc.reg_write(UC_ARM_REG_R0, s)</span><br><span class="line">    uc.reg_write(UC_ARM_REG_PC, uc.reg_read(UC_ARM_REG_LR))</span><br><span class="line"><span class="keyword">elif</span>(address==<span class="number">0x10d2c</span>):  </span><br><span class="line">    <span class="comment"># void * memcpy(void *__dest,void *__src,size_t __n)</span></span><br><span class="line">    __dest = uc.reg_read(UC_ARM_REG_R0)</span><br><span class="line">    __src  = uc.reg_read(UC_ARM_REG_R1)</span><br><span class="line">    __n    = uc.reg_read(UC_ARM_REG_R2) <span class="comment">#<span class="doctag">TODO:</span> hack</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hook memcpy&#x27;</span>, <span class="built_in">hex</span>(__dest), <span class="built_in">hex</span>(__src), __n)</span><br><span class="line">    dat = uc.mem_read(__src,__n)</span><br><span class="line">    uc.mem_write(__dest,<span class="built_in">bytes</span>(dat));</span><br><span class="line">    uc.reg_write(UC_ARM_REG_R0, __dest)</span><br><span class="line">    uc.reg_write(UC_ARM_REG_PC, uc.reg_read(UC_ARM_REG_LR))</span><br></pre></td></tr></table></figure>
<p>If the script succeeds, we can get the LUKS key at address 0x28c94. It is a string, and we can use this key to mount the LUKS file on a PC.</p>
<h2 id="Decrypt-config-dat-file"><a href="#Decrypt-config-dat-file" class="headerlink" title="Decrypt config.dat file"></a>Decrypt config.dat file</h2><p>The function at 0x011dc8 is a decryption function. loader uses it to decrypt config.dat and other configuration files for gaming. I wrote a Python <a target="_blank" rel="noopener" href="https://gist.github.com/mengxipeng1122/b161b62ce6ecaa9479ada6b1b45f99d8">script</a> to perform this decryption. The script saves the resulting file to &#x2F;tmp&#x2F;tt.bin.</p>
<h1 id="mkemu"><a href="#mkemu" class="headerlink" title="mkemu"></a>mkemu</h1><p><code>loader</code> starts <code>mkemu</code> using system. We can find the related instruction at address 0x01153c in <code>loader</code>. The Ghidra decompiled C code is as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  system(<span class="string">&quot;/home/games/mkemu&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;User app exit.&quot;</span>);</span><br><span class="line">  usleep(<span class="number">10000</span>);</span><br><span class="line">&#125; <span class="keyword">while</span>( <span class="literal">true</span> );</span><br></pre></td></tr></table></figure>
<h2 id="Analyzing-the-mkemu-program"><a href="#Analyzing-the-mkemu-program" class="headerlink" title="Analyzing the mkemu program"></a>Analyzing the mkemu program</h2><p>mkemu is the essential program for this game cartridge. It displays the game selection menu and allows users to play their selected game. After analyzing it using Ghidra, I believe it utilizes SDL.</p>
<h2 id="Decrypt-asset"><a href="#Decrypt-asset" class="headerlink" title="Decrypt asset"></a>Decrypt asset</h2><p>The programmer encrypted and packaged the assets in the file asset.dat. Therefore, we need to decrypt the assets using the Thumb instructions in mkemu. You can find the complete Python script in <a target="_blank" rel="noopener" href="https://gist.github.com/mengxipeng1122/22aee547f2f8348cfe469ca771671f5a">here</a>. This script will save each decrypted asset file in the target folder.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>This board isn’t very difficult, and I feel like hacking it is similar to participating in a Capture The Flag (CTF) competition. Every key is like a flag. The only difference is that the board is real.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Hacking Pandora&#039;s Box Game Cartridge 2</p><p><a href="http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/">http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Meng Xipeng</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-08-07</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-10-05</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Game/">Game</a><a class="link-muted mr-2" rel="tag" href="/tags/Hack/">Hack</a><a class="link-muted mr-2" rel="tag" href="/tags/Reverse-engineering/">Reverse engineering</a><a class="link-muted mr-2" rel="tag" href="/tags/ARM/">ARM</a><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/mengxipeng2" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="2769189982@qq.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/08/29/Hacking-Android-game-using-Frida-Part1/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Hacking Android game using Frida - Part1</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/01/04/hacking-pandroa-s-box-game-cartridge-1/"><span class="level-item">Hacking pandroa&#039;s box game cartridge 1</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://mengxipeng1122.github.io/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/';
            this.page.identifier = '2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'mengxipeng1122-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Meng Xipeng"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Meng Xipeng</p><p class="is-size-6 is-block">Reverse engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">14</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/mengxipeng1122" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/meng_xi_peng"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-31T07:24:00.000Z">2023-08-31</time></p><p class="title"><a href="/2023/08/31/Hacking-Android-game-using-Frida-Part3/">Hacking Android game using Frida - Part3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-29T06:53:23.000Z">2023-08-29</time></p><p class="title"><a href="/2023/08/29/Hacking-Android-game-using-Frida-Part2/">Hacking Android game using Frida - Part2</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-29T03:26:43.000Z">2023-08-29</time></p><p class="title"><a href="/2023/08/29/Hacking-Android-game-using-Frida-Part1/">Hacking Android game using Frida - Part1</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-07T06:12:53.000Z">2023-08-07</time></p><p class="title"><a href="/2023/08/07/Hacking-pandroa-s-box-game-cartridge-2/">Hacking Pandora&#039;s Box Game Cartridge 2</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-04T01:10:13.000Z">2023-01-04</time></p><p class="title"><a href="/2023/01/04/hacking-pandroa-s-box-game-cartridge-1/">Hacking pandroa&#039;s box game cartridge 1</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CModule/"><span class="tag">CModule</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Frida/"><span class="tag">Frida</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Game/"><span class="tag">Game</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hack/"><span class="tag">Hack</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hacking/"><span class="tag">Hacking</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Inline-hook/"><span class="tag">Inline hook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse-engineering/"><span class="tag">Reverse engineering</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Thumb/"><span class="tag">Thumb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hack/"><span class="tag">hack</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inlinehook/"><span class="tag">inlinehook</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Meng Xipeng&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Meng Xipeng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/mengxipeng1122"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>